
# SMS XML API

## Общие положения
SMS XML API — это простой протокол обмена сообщения с платформой SMS Centre Ukraine Ltd, который использует XML для формирования сообщений. Всё взаимодействие с
программой осуществляется посредством HTTP-протокола, методом POST.


## Схема взаимодействия
1. Отправитель создает сообщение представленное как «валидный» XML документ.
Поддерживаются две кодировки: UTF-8 и WINDOWS-1251
2. Отправитель создает HTTP соединение к адресу URL получателя.
3. Отправитель отсылает HTTP POST запрос, в теле которого находится
сгенерированный XML документ.
4. Получатель проверяет «валидность» документа и отправителя затем генерирует
ответ.
5. Получатель закрывает HTTP соединение.


## Адрес сервера
http://api.smscentre.com.ua/xml/bulk_sms.php


## Описание команд

### sendmessage
Отправка пакета СМС сообщений.

Запрос
```xml
<?xml version="1.0" encoding="utf-8"?>
<packet version="1.0">
<auth login="xxx" password="xxx"/>
<command name="sendmessage">
<bulk id="111" type="sms" name="Bulk number 5" alphaname="SMS Centre">
<data charset="cyr">test message ::Field1::</data>
<recipients>
<recipient id="001" address="+380667772611" field1="test">this is a ::Field1:: message </recipient>
<recipient id="002" address="+380977770511"/>
<recipient id="003" address="+380507777911" field1="test22"/>
</recipients>
</bulk>
</command>
</packet>
```

Параметры
<auth> — содержит имя входа и пароль, которые определяют уровень доступа, к сервису.
<command> — имя команды.
<bulk> — содержит идентификатор пакета (по клиентской идентификации) id название пакета (может быть пустым) name и альфаимя alphaname (должно быть одним из списка назначенных клиенту альфаимен, иначе подставляется умолчательное альфаимя системы).
<data> — содержит текст сообщения (может быть пустым, если присутсвуют индивидуальные тексты сообщений) и параметр указывающий кодировку сообщения charset (может принимать значения lat и cyr для СМС латиницей и кириллицей соответсвенно).
<recipients> — контейнер, который содержит 1 и более адресатов сообщения и их идентификаторов (по клиентской идентификации) с возможностью указания содержимого полей замены (::Field1:: … ::Field4::) если они присутствуют в сообщении, а также возможностью задания индивидуального текста сообщения.

Ответ
```xml
<?xml version="1.0" encoding="utf-8"?>
<packet version="1.0">
<result type="00">
<bulk id="111" bulkid="5">
<recipients>
<recipient id="001" address="+380667772611" smsid="190"/>
<recipient id="002" address="+380977770511" smsid="191"/>
<recipient id="003" address="+380507777911" smsid="192"/>
</recipients>
</bulk>
</result>
</packet>
```

Ответ содержит идентификаторы пакета bulkid и отдельных СМС smsid по идентификации сервера.
<result> — содержит код результата выполнения запроса.

### querymessage
Запрос статуса пакета СМС сообщений.

Запрос
```xml
<?xml version="1.0" encoding="utf-8"?>
<packet version="1.0">
<auth login="xxx" password="xxx"/>
<command name="querymessage">
<bulk bulkid="5"/>
</command>
</packet>
```

Параметры
<auth> — содержит имя входа и пароль, которые определяют уровень доступа, к сервису.
<command> — имя команды.
<bulk> — содержит идентификатор пакета (по серверной идентификации).

Ответ
```xml
<?xml version="1.0" encoding="utf-8"?>
<packet version="1.0">
<result type="00">
<bulk bulkid="5">
<recipients>
<recipient id="001" smsid="190" status="DELIVERED"/>
<recipient id="002" smsid="191" status="DELIVERED"/>
<recipient id="002" smsid="192" status="DELIVERED"/>
</recipients>
</bulk>
</result>
</packet>
```

Ответ статусы отдельных СМС.
<result> — содержит код результата выполнения запроса.


### getrecvmessages
Запрос принятых СМС сообщений.

Запрос
```xml
<?xml version="1.0" encoding="utf-8"?>
<packet version="1.0">
<auth login="ххх" password="ххх"/>
<command name="getrecvmessages">
<startdate>2009-09-02 00:00:00</startdate>
<enddate>2009-09-15 00:00:00</enddate>
</command>
</packet>
```

Параметры
<auth> — содержит имя входа и пароль, которые определяют уровень доступа, к сервису.
<command> — имя команды.
<startdate>, <enddate> -  дата и время (в каноническом ODBC формате) начала и окончания диапазона времени за который запрашиваются принятые СМС сообщения.

Ответ
```xml
<?xml version="1.0" encoding="utf-8"?>
<packet version="1.0">
<result type="00">
<messages>
<message smsid="1" date="2009-09-02 11:16:10" addrfrom="380667772611" addrto="380977770511">test</message>
<message smsid="2" date="2009-09-14 12:30:40" addrfrom="380507777911" addrto="380977770511">test</message>
</messages>
</result>
</packet>
```
Ответ статусы отдельных СМС.
<result> — содержит код результата выполнения запроса.
< messages > — контейнер, который содержит 1 и более СМС принятых на выделенный номер за указанный период времени.



Коды результатов выполнения запроса
     - 00 – запрос успешно обработан
     - 01 - неверные значения параметров или недостаточное кол-во параметров
     - 02 - ошибка соединения с сервером баз данных
     - 03 - не найдена база данных
     - 04 - сбой процедуры авторизации
     - 05 - неверное имя пользователя или пароль
     - 06 – ошибка выполнения операции

Статусы СМС
     - TOSEND - сообщение находится в очереди на отправку
     - ENROUTE - сообщение отправлено, но еще не доставлено адресату
     - PAUSED - отправка сообщения приостановлена
     - CANCELED - отправка сообщения отменена
     - DELIVERED - сообщение доставлено адресату
     - FAILED - ошибка отправки сообщения
     - EXPIRED - сообщение не доставлено адресату - истек срок доставки
     - UNDELIVERABLE - сообщение не может быть доставлено адресату
     - REJECTED - сообщение отклонено сервером
     - BADCOST - сообщение не доставлено адресату - не определена стоимость сообщения
     - UNKNOWN - состояние сообщения не определено



### getsmslimit
Запрос остатка СМС на учетной записи.

Запрос
```xml
<?xml version="1.0" encoding="utf-8"?>
<packet version="1.0">
<auth login="ххх" password="ххх"/>
<command name="getsmslimit"/>
</packet>
```

Параметры
<auth> — содержит имя входа и пароль, которые определяют уровень доступа, к сервису.
<command> — имя команды.

Ответ
```xml
<?xml version="1.0" encoding="utf-8"?>
<packet version="1.0">
<result type="00">
<smslimit>4</smslimit>
</result>
</packet>
```
Ответ статусы отдельных СМС.
<result> — содержит код результата выполнения запроса.
< smslimit > — содержит остаток СМС на учетной записи.


Коды результатов выполнения запроса
     - 00 – запрос успешно обработан
     - 01 - неверные значения параметров или недостаточное кол-во параметров
     - 02 - ошибка соединения с сервером баз данных
     - 03 - не найдена база данных
     - 04 - сбой процедуры авторизации
     - 05 - неверное имя пользователя или пароль
     - 06 – ошибка выполнения операции

Статусы СМС
     - TOSEND - сообщение находится в очереди на отправку
     - ENROUTE - сообщение отправлено, но еще не доставлено адресату
     - PAUSED - отправка сообщения приостановлена
     - CANCELED - отправка сообщения отменена
     - DELIVERED - сообщение доставлено адресату
     - FAILED - ошибка отправки сообщения
     - EXPIRED - сообщение не доставлено адресату - истек срок доставки
     - UNDELIVERABLE - сообщение не может быть доставлено адресату
     - REJECTED - сообщение отклонено сервером
     - BADCOST - сообщение не доставлено адресату - не определена стоимость сообщения
     - UNKNOWN - состояние сообщения не определено
